---
import { CONFIG } from '../shared/config/app-config.js';
import DebugStyles from '../shared/components/DebugStyles.astro';
import DebugControls from '../shared/components/DebugControls.astro';
import VideoDebugPlayer from '../shared/components/VideoDebugPlayer.astro';
import DebugLogger from '../shared/components/DebugLogger.astro';

const defaultHost = CONFIG.rtmp.defaultHost;
const defaultStreamPath = `${CONFIG.rtmp.defaultApp}/${CONFIG.rtmp.defaultStream}`;
const debugConfig = {
  host: defaultHost,
  streamPath: defaultStreamPath,
  webrtcPort: CONFIG.webrtc.defaultPort,
  rtmpPort: CONFIG.rtmp.defaultPort,
  timeoutMs: CONFIG.connection.timeoutMs,
  apiEndpoints: CONFIG.connection.testEndpoints
};
---

<html lang="zh">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebRTCè§†é¢‘æ’­æ”¾è°ƒè¯•é¡µé¢</title>
    <DebugStyles />
  </head>
  <body>
    <div class="debug-container">
      <h1>ğŸ” WebRTCè§†é¢‘æ’­æ”¾è°ƒè¯•å·¥å…·</h1>

      <DebugControls 
        defaultHost={defaultHost}
        defaultStreamPath={defaultStreamPath}
      />

      <VideoDebugPlayer />

      <DebugLogger />
    </div>

    <script type="module" is:inline define:vars={{ debugConfig }}>
      import { DebugWebRTCPlayer } from '/src/scripts/debug-webrtc.js';
      import { debugLogger } from '/src/scripts/debug-logger.js';

      const player = new DebugWebRTCPlayer(debugConfig);

      // å…¨å±€å‡½æ•°
      window.startPlay = () => player.startPlay();
      window.stopPlay = () => player.stopPlay();
      window.debugVideo = () => player.debugVideo();
      window.testConnection = () => player.testConnection();
      window.clearLogs = () => debugLogger.clearLogs();
    </script>
  </body>
</html>